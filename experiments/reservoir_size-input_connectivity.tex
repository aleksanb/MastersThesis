\section{Minimum required reservoir size, optimal input connectivity}

In the chapter summarizing my previous paper \ref{background:my-previous-paper},
we saw that there was a plethora of RRC systems with $N=100, K=\{2, 3\}$ that were able to solve TP3 (Temporal Parity with a window size of 3).

With TP5, $N=100, K=3$ was barely enough for a few of the generated reservoirs to reach an accuracy of over 95\%.
In both cases the reservoirs with $K=3$ performed better than their $K=\{1, 2\}$ brethren,
with $K=3$ being requried for TP5.
A homogenous connectivity of $K=3$ will therefore be chosen as the only connectivity looked at in these experiments
It more closely approximates $\langle K \rangle = 2 $, where most critical reservoirs are found,
as well as reducing the size of the parameter space we have to search.

To find the minimum required reservoir size,
we'll be creating reservoirs with the parameters presented in table \ref{tab:ic-reservoir-parameters},
for all four task combinations presented in table \ref{tab:tasks},
namely TP3, TP5, TD3 and TD5 (TP = Temporal Parity, TD = Temporal Density, number equals window size).
Presumably the TP3 task can be solved with a much smaller reservoir,
while TP5 might require a slightly larger reservoir.
As the TD task is computationally less expensive,
we can expect a smaller required reservoir size.

\begin{table}[ht]
    \centering
    \caption{Task parameters. The tasks are explained in detail in chapter \ref{section:tasks}}
    \label{tab:tasks}
    \begin{tabular}{ll}
        Task type               & Temporal Parity and Temporal Density \\
        Training dataset length & 4 000                       \\
        Test dataset length     & 200                         \\
        $N$ (window size)       & 3 and 5                     \\
        $t$ (offset)            & 0
    \end{tabular}
\end{table}

\begin{table}[ht]
    \centering
    \caption{Reservoir parameters for optimal input connectivity}
    \label{tab:ic-reservoir-parameters}
    \begin{tabular}{ll}
        Nodes               & 10 to (100, 140) for TP, 5 to (35, 65) for TD \\
        Node step size      & 10 for TP, 5 for TD \\
        Connectivity        & 3                              \\
        Input connectivity  & [0..n\_nodes], step size = 5   \\
		Output connectivity & n\_nodes                       \\
        Sample size         & 50
    \end{tabular}
\end{table}

For each reservoir size, we'll also iterate over the input connectivities,
to find which input connectivity gives the greatest population accuracy.
In my previous paper \ref{background:my-previous-paper},
the optimal input connectivity seemed to lie at roughly $ 0.5*n\_nodes $,
with the $K=3$ reservoirs having a slight skew to the right.
The Temporal Density task might have different input connectivity requirements to the Temporal Parity task.

The resulting accuracies wil be plotted as boxplots, as previously done in \ref{background:my-previous-paper}.
This should allow for visual identification of where the optimal reservoir size lies for each task,
as well as the optimal input connectivity.

\subsection{Results}

Task accuracy thresholds,
defined as the smallest reservoir size where at least two reservoirs have the required accuracy,
are presented in figure \ref{fig:accuracy-threshold-size} and table \ref{tab:accuracy-thresholds}.
The 90\% accuracy threshold is also included in table \ref{tab:accuracy-thresholds} as it appears quite a bit earlier than the 98\% threshold for tasks with a window size of 5.

\begin{figure}[ht]
    \centering
    \caption{
        Accuracy plots for the required reservoir sizes to reach the 98\% accuracy threshold for each of the four tasks:
        TP3 (Figure \ref{fig:threshold-TP3}), TP5 (Figure \ref{fig:threshold-TP5}), TD3 (Figure \ref{fig:threshold-TD3}) and TD5 (Figure \ref{fig:threshold-TD5}).
        The x-axis for all plots has been normalized to the largest reservoir size, $N=90$.
    }
    \label{fig:accuracy-threshold-size}
    \resizebox{\textwidth}{!}{
        \subfloat[TP3, N=20]{
            \input{experiments/results/normalized-threshold-plots/boxplot-input_connectivity-N20-K3-S50.tex}
            \label{fig:threshold-TP3}
        }
        \subfloat[TP5, N=90]{
            \input{experiments/results/normalized-threshold-plots/boxplot-input_connectivity-N90-K3-S50.tex}
            \label{fig:threshold-TP5}
        }
    }
    \resizebox{\textwidth}{!}{
        \subfloat[TD3, N=10]{
            \input{experiments/results/normalized-threshold-plots/boxplot-input_connectivity-N10-K3-S50.tex}
            \label{fig:threshold-TD3}
        }
        \subfloat[TD5, N=55]{
            \input{experiments/results/normalized-threshold-plots/boxplot-input_connectivity-N55-K3-S50.tex}
            \label{fig:threshold-TD5}
        }
    }
\end{figure}

\begin{table}[ht]
    \centering
    \caption{Accuracy thresholds for all four tasks.}
    \label{tab:accuracy-thresholds}
    \begin{tabular}{lllll}
                            & TP3 & TP5 & TD3 & TD5 \\
    90\% accuracy threshold & ~15 & 70  & 10  & 30  \\
    98\% accuracy threshold & 20  & 90  & 10  & 55
    \end{tabular}
\end{table}

The number of input connectivity plots resulting from the reservoir (table \ref{tab:ic-reservoir-parameters}) and task parameter (table \ref{tab:tasks}) combinations is quite large.
Therefore only reservoir sizes of $ N=[10...30, 80...100]$ from the accuracy distributions on the Temporal Parity 3 task is shown here (figure \ref{fig:TP3-IC}).
There is a slight skew to each side of $ 0.5 * n\ _nodes $ dependent on whether the task chosen is Temporal Parity or Temporal Density.
This is observable in figure \ref{fig:TP3-IC} for TP3 and appendix \ref{app:reservoir_size-input_connectivity} figures \label{fig:TP3-IC-1} through \label{fig:TD5-IC-2} for the remaining tasks.

\begin{figure*}[ht]
    \centering
    \caption{
        Plots of input connectivity against accuracy on TP3. Reservoir sizes $[40..70]$ are omitted for brevity.
        Note that the optimal input connectivity tends slightly to the right of the middle for all reservoir sizes.
        The omitted plots are presented in figures \ref{fig:TP3-IC-1} and \ref{fig:TP3-IC-2} in appendix \ref{app:reservoir_size-input_connectivity}.
        }
    \label{fig:TP3-IC}
    \resizebox{\textwidth}{!}{
        \subfloat[N=10]{
            \input{experiments/results/TP3-IO/boxplot-input_connectivity-N10-K3-S50.tex}
        }
        \subfloat[N=80]{
            \input{experiments/results/TP3-IO/boxplot-input_connectivity-N80-K3-S50.tex}
        }
    }
    \resizebox{\textwidth}{!}{
        \subfloat[N=20]{
            \input{experiments/results/TP3-IO/boxplot-input_connectivity-N20-K3-S50.tex}
        }
        \subfloat[N=90]{
            \input{experiments/results/TP3-IO/boxplot-input_connectivity-N90-K3-S50.tex}
        }
    }
    \resizebox{\textwidth}{!}{
        \subfloat[N=30]{
            \input{experiments/results/TP3-IO/boxplot-input_connectivity-N30-K3-S50.tex}
        }
        \subfloat[N=100]{
            \input{experiments/results/TP3-IO/boxplot-input_connectivity-N100-K3-S50.tex}
        }
    }
\end{figure*}

We confirm this skew by calculating the optimal input connectivity for each task as follows:
\begin{equation} \label{eq:optimal-ic}
optimal\_ic^{task} = average(max\_accuracy\_ic_{n\_nodes}^{task} / n\_nodes)
\end{equation}
where $ max\_accuracy\_ic_{n\_nodes}^{task} $ is the connectivity which gives the highest number of high-accuracy reservoirs for that task and reservoir size.
The results are presented in table \ref{tab:optimal-ic}.

\begin{table}[h]
	\centering
	\caption{Optimal input connectivities as fraction of reservoir size.}
	\label{tab:optimal-ic}
	\begin{tabular}{lllll}
						 & $T=3$  & $T=5$ \\
        Temporal Parity  & 0.528          & 0.489         \\
        Temporal Density & 0.439          & 0.443
	\end{tabular}
\end{table}

\subsection{Discussion}

\subsubsection{Required reservoir size}

In section \ref{my previous paper} Temporal Density was experimentally found to be the more difficult task, and therefore chosen for benchmarking the reservoirs.
Reservoirs with $N=100, K=3$ were found to be overkill for TP3, while being on the edge of solving TP5.
The expected relationship between the relative difficulties of the four tasks is therefore $ TD3 <= TP3 <= TD5 <= TP5 $.
Figure \label{fig:threshold-TP3} and table \ref{tab:accuracy-thresholds} confirms this suspicion.
For the same window size, Temporal Parity requires a larger reservoir.
The additional computational requirements of being able to remember five timesteps into the past requires quite a ramp up in reservoir size.

A reservoir of size 20 is large enough for TP3 (a bit lower than the 100 nodes used in my previous paper).
$ n\_nodes = 90 $ appears sufficient for TP5, slightly lower than in the previous experiments,
although the entire accuracy distribution doesn't increase significantly untill $ n\_nodes = 120 $, as shown in figure \ref{fig:TP5-IC-2}.
For TD3, a tiny reservoir of size 10 is sufficient, with a reservoir of size 5 achieving 90\% accuracy!
There is a corresponding ramp-up in required reservoir size to 55 to achieve 98\% accuracy on TD5.

Using this knowledge and the RRC system as an abstraction over a physical RC device,
one can simulate roughly the required size of a reservoir based on the pysical reservoirs estimated connectivity.
With this knowledge, one can create a physical reservoir just the right size for the computational problem at hand.

\subsubsection{Optimal input connectivity}

Temporal Density had an optimal input connectivity of roughly 0.44, while Temporal Parity lay around 0.50.
These values differ relatively little across tasks,
which is to be expected as the reservoir connectivity is the main factor in how large a reservoir perturbance is required \cm{thatpaperwiththeoreticalcomputationsforinputconnectivity},
with higher connectivities requiring larger perturbances lest the input be lost in the chaotic transitions of the reservoir.
This knowledge can be used to assist in choosing the degree of perturbance of a real-life reservoir computing system.
If one is able to measure the connectivity of the reservoir,
one can select a reasonable starting point for the amount of reservoir perturbance.
